# ğŸ“ Arquitectura MongoDB - Real Estate API

## ğŸ—ï¸ Diagrama General de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     .NET/C# Real Estate API                     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Controllers Layer                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         PropertiesController                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  GET    /api/properties                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  GET    /api/properties/{id}                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  POST   /api/properties                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  PUT    /api/properties/{id}                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  DELETE /api/properties/{id}                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  POST   /api/properties/filter                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Services Layer                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  IPropertyService / PropertyService                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GetAllPropertiesAsync()                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GetPropertyByIdAsync()                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CreatePropertyAsync()                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ UpdatePropertyAsync()                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ DeletePropertyAsync()                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ FilterPropertiesAsync()                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Repository Layer (Data Access)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ IPropertyRepository / PropertyRepository            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ GetAllAsync()                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ GetByIdAsync()                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ GetByOwnerAsync()                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ GetByPriceRangeAsync()                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ SearchByNameAsync()                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ SearchByAddressAsync()                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ CreateAsync()                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ UpdateAsync()                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ DeleteAsync()                                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           MongoDB Context / Client Layer                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  MongoDbContext                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ IMongoClient (Singleton)                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ IMongoDatabase (RealStateDB)                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ IMongoCollection<Property>                       â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MongoDB Server                             â”‚
â”‚                  (localhost:27017)                              â”‚
â”‚                                                                  â”‚
â”‚  Database: RealStateDB                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Collection: properties                                     â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Document Schema:                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ _id         : ObjectId                               â”‚ â”‚â”‚
â”‚  â”‚  â”‚ idOwner     : ObjectId | String                      â”‚ â”‚â”‚
â”‚  â”‚  â”‚ name        : String (3-255)                         â”‚ â”‚â”‚
â”‚  â”‚  â”‚ address     : String (5-500)                         â”‚ â”‚â”‚
â”‚  â”‚  â”‚ price       : Decimal (â‰¥ 0)                          â”‚ â”‚â”‚
â”‚  â”‚  â”‚ image       : String (URL)                           â”‚ â”‚â”‚
â”‚  â”‚  â”‚ createdAt   : Date                                   â”‚ â”‚â”‚
â”‚  â”‚  â”‚ updatedAt   : Date                                   â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Ãndices:                                                  â”‚â”‚
â”‚  â”‚  â€¢ name (texto)                                           â”‚â”‚
â”‚  â”‚  â€¢ address (texto)                                        â”‚â”‚
â”‚  â”‚  â€¢ price (1)                                              â”‚â”‚
â”‚  â”‚  â€¢ idOwner (1)                                            â”‚â”‚
â”‚  â”‚  â€¢ createdAt (-1)                                         â”‚â”‚
â”‚  â”‚  â€¢ (price, createdAt) compuesto                           â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Documentos: 8 de prueba                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Solicitud HTTP

```
Cliente HTTP
     â”‚
     â”‚ GET /api/properties?minPrice=100000&maxPrice=300000
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PropertiesController.FilterProperties â”‚
â”‚   [HttpPost("filter")]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ PropertyFilterDto
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PropertyService     â”‚
        â”‚  FilterPropertiesAsync()
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PropertyRepository          â”‚
        â”‚  GetByPriceRangeAsync()       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  MongoDbContext              â”‚
        â”‚  Properties Collection       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MongoDB Query              â”‚
        â”‚ db.properties.find({         â”‚
        â”‚   price: {                   â”‚
        â”‚     $gte: 100000,            â”‚
        â”‚     $lte: 300000             â”‚
        â”‚   }                          â”‚
        â”‚ })                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ List<Property>
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Mapping to DTOs             â”‚
        â”‚  Property â†’ PropertyDto      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ ApiResponse<IEnumerable<PropertyDto>>
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  JSON Response               â”‚
        â”‚  HTTP 200 OK                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
             Cliente
```

---

## ğŸ“Š Ciclo de Vida de una Propiedad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        1. CREACIÃ“N (POST /api/properties)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  Request Body:                                       â”‚
â”‚  {                                                   â”‚
â”‚    "idOwner": "507f1f77bcf86cd799439010",           â”‚
â”‚    "name": "Nueva Casa",                            â”‚
â”‚    "address": "Calle Nueva 100",                    â”‚
â”‚    "price": 250000,                                 â”‚
â”‚    "image": "https://..."                           â”‚
â”‚  }                                                   â”‚
â”‚                                                       â”‚
â”‚  MongoDB:                                            â”‚
â”‚  âœ“ Genera _id automÃ¡ticamente                        â”‚
â”‚  âœ“ Valida esquema JSON                              â”‚
â”‚  âœ“ Establece createdAt = ahora                       â”‚
â”‚  âœ“ Establece updatedAt = ahora                       â”‚
â”‚  âœ“ Inserta documento                                 â”‚
â”‚                                                       â”‚
â”‚  Response: HTTP 201 Created + PropertyDto            â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    2. LECTURA (GET /api/properties/{id})            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  MongoDB:                                            â”‚
â”‚  âœ“ Busca por _id                                     â”‚
â”‚  âœ“ Ãndice acelera bÃºsqueda                          â”‚
â”‚  âœ“ Retorna documento                                 â”‚
â”‚                                                       â”‚
â”‚  Response: HTTP 200 OK + PropertyDto                â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    3. ACTUALIZACIÃ“N (PUT /api/properties/{id})      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  Request Body:                                       â”‚
â”‚  {                                                   â”‚
â”‚    "name": "Casa Renovada",                         â”‚
â”‚    "price": 260000,                                 â”‚
â”‚    ...                                               â”‚
â”‚  }                                                   â”‚
â”‚                                                       â”‚
â”‚  MongoDB:                                            â”‚
â”‚  âœ“ Encuentra documento por _id                       â”‚
â”‚  âœ“ Actualiza campos                                  â”‚
â”‚  âœ“ Valida esquema JSON nuevamente                   â”‚
â”‚  âœ“ Establece updatedAt = ahora                       â”‚
â”‚  âœ“ Guarda cambios                                    â”‚
â”‚                                                       â”‚
â”‚  Response: HTTP 200 OK                              â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    4. ELIMINACIÃ“N (DELETE /api/properties/{id})     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  MongoDB:                                            â”‚
â”‚  âœ“ Encuentra documento por _id                       â”‚
â”‚  âœ“ Elimina documento                                 â”‚
â”‚  âœ“ No hay recuperaciÃ³n (cuidado!)                    â”‚
â”‚                                                       â”‚
â”‚  Response: HTTP 200 OK                              â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Estructura de Carpetas

```
RealStateAPI/
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ PropertiesController.cs
â”‚       â”œâ”€â”€ GET /api/properties
â”‚       â”œâ”€â”€ GET /api/properties/{id}
â”‚       â”œâ”€â”€ POST /api/properties
â”‚       â”œâ”€â”€ PUT /api/properties/{id}
â”‚       â”œâ”€â”€ DELETE /api/properties/{id}
â”‚       â””â”€â”€ POST /api/properties/filter
â”‚
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ Property.cs
â”‚       â””â”€â”€ [MapBson] â†” MongoDB Document
â”‚
â”œâ”€â”€ DTOs/
â”‚   â”œâ”€â”€ PropertyDto.cs
â”‚   â”œâ”€â”€ PropertyFilterDto.cs
â”‚   â””â”€â”€ ApiResponse.cs
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IPropertyService.cs
â”‚   â”œâ”€â”€ PropertyService.cs
â”‚   â””â”€â”€ MongoDbContext.cs
â”‚
â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ IPropertyRepository.cs
â”‚   â””â”€â”€ PropertyRepository.cs
â”‚
â”œâ”€â”€ Configuration/
â”‚   â””â”€â”€ MongoDbSettings.cs
â”‚
â”œâ”€â”€ Middleware/
â”‚   â””â”€â”€ ExceptionHandlingMiddleware.cs
â”‚
â”œâ”€â”€ Properties/
â”‚   â””â”€â”€ launchSettings.json
â”‚
â”œâ”€â”€ Program.cs
â”‚   â”œâ”€â”€ DI Container
â”‚   â”œâ”€â”€ Middleware
â”‚   â””â”€â”€ Servicios registrados
â”‚
â”œâ”€â”€ appsettings.json
â”‚   â””â”€â”€ ConnectionString: mongodb://localhost:27017
â”‚
â””â”€â”€ RealStateAPI.csproj
    â”œâ”€â”€ MongoDB.Driver
    â”œâ”€â”€ MongoDB.Bson
    â””â”€â”€ Framework: .NET 8.0
```

---

## ğŸ”— Flujos de IntegraciÃ³n de Datos

### PatrÃ³n: Repositorio â†’ Servicio â†’ Controlador

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PropertyDto (Entrada HTTP)       â”‚
â”‚  {                                     â”‚
â”‚    idOwner: "...",                     â”‚
â”‚    name: "...",                        â”‚
â”‚    address: "...",                     â”‚
â”‚    price: 250000,                      â”‚
â”‚    image: "..."                        â”‚
â”‚  }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Mapeo
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Property (Modelo de Dominio)     â”‚
â”‚  {                                     â”‚
â”‚    Id: null,                           â”‚
â”‚    IdOwner: "...",                     â”‚
â”‚    Name: "...",                        â”‚
â”‚    Address: "...",                     â”‚
â”‚    Price: 250000,                      â”‚
â”‚    Image: "...",                       â”‚
â”‚    CreatedAt: DateTime.UtcNow,         â”‚
â”‚    UpdatedAt: DateTime.UtcNow          â”‚
â”‚  }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Persistencia
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MongoDB BSON Document            â”‚
â”‚  {                                     â”‚
â”‚    _id: ObjectId("..."),               â”‚
â”‚    idOwner: ObjectId("..."),           â”‚
â”‚    name: "...",                        â”‚
â”‚    address: "...",                     â”‚
â”‚    price: 250000.0,                    â”‚
â”‚    image: "...",                       â”‚
â”‚    createdAt: ISODate("..."),          â”‚
â”‚    updatedAt: ISODate("...")           â”‚
â”‚  }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Rendimiento de Ãndices

### BÃºsqueda sin Ãndice

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  db.properties.find({price: 250000})â”‚
â”‚                                      â”‚
â”‚  MongoDB debe:                       â”‚
â”‚  1. Escanear TODA la colecciÃ³n      â”‚
â”‚  2. Comparar cada documento          â”‚
â”‚  3. Retornar resultado               â”‚
â”‚                                      â”‚
â”‚  âš ï¸ Lento para colecciones grandes  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Tiempo: O(n) â†’ Lineal
```

### BÃºsqueda CON Ãndice

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  db.properties.find({price: 250000})â”‚
â”‚                                      â”‚
â”‚  MongoDB:                            â”‚
â”‚  1. Usa Ã­ndice B-tree                â”‚
â”‚  2. BÃºsqueda directa                 â”‚
â”‚  3. Retorna resultado (instantÃ¡neo)  â”‚
â”‚                                      â”‚
â”‚  âœ“ Muy rÃ¡pido incluso con millones  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Tiempo: O(log n) â†’ LogarÃ­tmico
```

---

## ğŸ” Flujo de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cliente HTTP (Request)           â”‚
â”‚  Authorization: Bearer {token}         â”‚
â”‚  Content-Type: application/json        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Middleware:         â”‚
        â”‚  - Auth Validation   â”‚
        â”‚  - CORS              â”‚
        â”‚  - Exception Handler â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Controller          â”‚
        â”‚  - ValidaciÃ³n Input  â”‚
        â”‚  - ModelState Check  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Repository          â”‚
        â”‚  - MongoDB Connectionâ”‚
        â”‚  - Query Execution   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  MongoDB            â”‚
        â”‚  - Schema Validation â”‚
        â”‚  - Access Control    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Response            â”‚
        â”‚  - Data Filtering    â”‚
        â”‚  - JSON Encoding     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Escalabilidad

### Horizontalmente (MÃºltiples Servidores)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Load Balancer      â”‚
                    â”‚  (Nginx/IIS)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚             â”‚             â”‚
                 â–¼             â–¼             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ API #1 â”‚    â”‚ API #2 â”‚    â”‚ API #3 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚             â”‚             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MongoDB Replica Setâ”‚
                    â”‚  - Primary          â”‚
                    â”‚  - Secondary        â”‚
                    â”‚  - Secondary        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Verticalmente (Mayor Poder)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     API Server (escala vertical)    â”‚
â”‚                                      â”‚
â”‚  - MÃ¡s CPU cores                     â”‚
â”‚  - MÃ¡s RAM                           â”‚
â”‚  - SSD mÃ¡s rÃ¡pido                    â”‚
â”‚  - Conexiones simultÃ¡neas            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MongoDB Server (escala vertical)   â”‚
â”‚                                      â”‚
â”‚  - MÃ¡s CPU cores                     â”‚
â”‚  - Mayor buffer pool                 â”‚
â”‚  - RAID 10 SSD                       â”‚
â”‚  - Cache mÃ¡s grande                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ OptimizaciÃ³n de Consultas

### Consulta Original (Sin Optimizar)

```javascript
// âŒ Lento - Sin Ã­ndices
db.properties
  .find({
    idOwner: ownerId,
    price: { $gte: 100000, $lte: 300000 },
  })
  .sort({ createdAt: -1 })
  .limit(10);
```

### Consulta Optimizada

```javascript
// âœ“ RÃ¡pido - Con Ã­ndices
// Ãndice: { price: 1, createdAt: -1 }
db.properties
  .find({
    idOwner: ownerId,
    price: { $gte: 100000, $lte: 300000 },
  })
  .sort({ createdAt: -1 })
  .limit(10);
```

---

## ğŸ“ Referencias TÃ©cnicas

- **BSON:** Binary JSON (formato almacenamiento MongoDB)
- **ObjectId:** Identificador Ãºnico de 12 bytes
- **Ãndice B-tree:** Estructura para bÃºsqueda rÃ¡pida
- **Replica Set:** Redundancia de datos
- **Sharding:** Particionamiento horizontal

---

**Ãšltima actualizaciÃ³n:** 18 de octubre de 2025  
**Arquitectura:** Clean Architecture  
**PatrÃ³n CRUD:** Completo  
**Escalabilidad:** Horizontal y Vertical âœ“
